# _flepiMoP_ Options and Commands

## üñ•Ô∏è Command Line Input

_flepiMoP_ allows some input parameters/options to be specified in the command line (in addition to/instead of in configuration files). There are currently six commands in _flepiMoP_:

* `simulate`, to forward simulate a model using `gempyor`
* `patch`, to patch two or more configuration files together
    * Merging overrides the top level keys in config files. The order of the config files is important, as the last file has the highest priority and the first has the lowest.
* `compartments`, to plot or export compartment modules
* `modifiers`, to plot or export modifiers modules
* `batch-calibrate`, to submit a calibration job to a batch system.
* `sync`, to sync flepiMoP files between local and remote locations.

In all cases, command line arguments override configuration file entries, which override environmental variables. The order of the command line arguments does not matter. See below for documentation on the subcommands/options of `flepimop simulate`, `flepimop patch`, `flepimop compartments`, `flepimop modifiers`, `flepimop batch-calibrate`, and `flepimop sync`. Alternatively, you can run

```bash
flepimop <command> --help
```

to see CLI help in terminal.


## modifiers:

### config-plot
| name            | option                   | type                                     | description                                            | default   |
|:----------------|:-------------------------|:-----------------------------------------|:-------------------------------------------------------|:----------|
| config_filepath | ['-c', '--config']       | <click.types.Path object at 0x12e261ee0> | configuration file for this simulation                 |           |
| project_path    | ['-p', '--project_path'] | <click.types.Path object at 0x12e262180> | path to the flepiMoP directory                         | .         |
| run_id          | ['--id', '--id']         | STRING                                   | Unique identifier for this run                         |           |
| nsamples        | ['--nsamples']           | INT                                      | Number of samples to draw                              | 30        |
| subpop          | ['--subpop']             | STRING                                   | Subpopulation to plot, if not set then all are plotted |           |

## compartments:

### plot
| name                        | option                                  | type                                     | description                                           | default   |
|:----------------------------|:----------------------------------------|:-----------------------------------------|:------------------------------------------------------|:----------|
| config_filepath             | ['-c', '--config']                      | <click.types.Path object at 0x12de96090> | Deprecated: configuration file(s) for this simulation |           |
| seir_modifiers_scenarios    | ['-s', '--seir_modifiers_scenarios']    | STRING                                   | override/select the transmission scenario(s) to run   | []        |
| outcome_modifiers_scenarios | ['-d', '--outcome_modifiers_scenarios'] | STRING                                   | override/select the outcome scenario(s) to run        | []        |
| jobs                        | ['-j', '--jobs']                        | <IntRange x>=1>                          | the parallelization factor                            | 4         |
| nslots                      | ['-n', '--nslots']                      | <IntRange x>=1>                          | override the # of simulation runs in the config file  |           |
| in_run_id                   | ['--in-id']                             | STRING                                   | Unique identifier for the run                         |           |
| out_run_id                  | ['--out-id']                            | STRING                                   | Unique identifier for the run                         |           |
| in_prefix                   | ['--in-prefix']                         | STRING                                   | unique identifier for the run                         |           |
| first_sim_index             | ['-i', '--first_sim_index']             | <IntRange x>=1>                          | The index of the first simulation                     | 1         |
| stoch_traj_flag             | ['--stochastic']                        | BOOL                                     | Run stochastic simulations?                           | False     |
| write_csv                   | ['--write-csv']                         | BOOL                                     | write csv output?                                     | False     |
| write_parquet               | ['--write-parquet']                     | BOOL                                     | write parquet output?                                 | True      |

### export
| name                        | option                                  | type                                     | description                                           | default   |
|:----------------------------|:----------------------------------------|:-----------------------------------------|:------------------------------------------------------|:----------|
| config_filepath             | ['-c', '--config']                      | <click.types.Path object at 0x12de96090> | Deprecated: configuration file(s) for this simulation |           |
| seir_modifiers_scenarios    | ['-s', '--seir_modifiers_scenarios']    | STRING                                   | override/select the transmission scenario(s) to run   | []        |
| outcome_modifiers_scenarios | ['-d', '--outcome_modifiers_scenarios'] | STRING                                   | override/select the outcome scenario(s) to run        | []        |
| jobs                        | ['-j', '--jobs']                        | <IntRange x>=1>                          | the parallelization factor                            | 4         |
| nslots                      | ['-n', '--nslots']                      | <IntRange x>=1>                          | override the # of simulation runs in the config file  |           |
| in_run_id                   | ['--in-id']                             | STRING                                   | Unique identifier for the run                         |           |
| out_run_id                  | ['--out-id']                            | STRING                                   | Unique identifier for the run                         |           |
| in_prefix                   | ['--in-prefix']                         | STRING                                   | unique identifier for the run                         |           |
| first_sim_index             | ['-i', '--first_sim_index']             | <IntRange x>=1>                          | The index of the first simulation                     | 1         |
| stoch_traj_flag             | ['--stochastic']                        | BOOL                                     | Run stochastic simulations?                           | False     |
| write_csv                   | ['--write-csv']                         | BOOL                                     | write csv output?                                     | False     |
| write_parquet               | ['--write-parquet']                     | BOOL                                     | write parquet output?                                 | True      |

## simulate:

### simulate
| name                        | option                                  | type                                     | description                                           | default   |
|:----------------------------|:----------------------------------------|:-----------------------------------------|:------------------------------------------------------|:----------|
| config_filepath             | ['-c', '--config']                      | <click.types.Path object at 0x12de96090> | Deprecated: configuration file(s) for this simulation |           |
| seir_modifiers_scenarios    | ['-s', '--seir_modifiers_scenarios']    | STRING                                   | override/select the transmission scenario(s) to run   | []        |
| outcome_modifiers_scenarios | ['-d', '--outcome_modifiers_scenarios'] | STRING                                   | override/select the outcome scenario(s) to run        | []        |
| jobs                        | ['-j', '--jobs']                        | <IntRange x>=1>                          | the parallelization factor                            | 4         |
| nslots                      | ['-n', '--nslots']                      | <IntRange x>=1>                          | override the # of simulation runs in the config file  |           |
| in_run_id                   | ['--in-id']                             | STRING                                   | Unique identifier for the run                         |           |
| out_run_id                  | ['--out-id']                            | STRING                                   | Unique identifier for the run                         |           |
| in_prefix                   | ['--in-prefix']                         | STRING                                   | unique identifier for the run                         |           |
| first_sim_index             | ['-i', '--first_sim_index']             | <IntRange x>=1>                          | The index of the first simulation                     | 1         |
| stoch_traj_flag             | ['--stochastic']                        | BOOL                                     | Run stochastic simulations?                           | False     |
| write_csv                   | ['--write-csv']                         | BOOL                                     | write csv output?                                     | False     |
| write_parquet               | ['--write-parquet']                     | BOOL                                     | write parquet output?                                 | True      |

## batch-calibrate:

### batch-calibrate
| name                        | option                                  | type                                                                                                                                       | description                                                                                                                                                                                                                                                                                  | default                             |
|:----------------------------|:----------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:------------------------------------|
| config_filepath             | ['-c', '--config']                      | <click.types.Path object at 0x12de96090>                                                                                                   | Deprecated: configuration file(s) for this simulation                                                                                                                                                                                                                                        |                                     |
| seir_modifiers_scenarios    | ['-s', '--seir_modifiers_scenarios']    | STRING                                                                                                                                     | override/select the transmission scenario(s) to run                                                                                                                                                                                                                                          | []                                  |
| outcome_modifiers_scenarios | ['-d', '--outcome_modifiers_scenarios'] | STRING                                                                                                                                     | override/select the outcome scenario(s) to run                                                                                                                                                                                                                                               | []                                  |
| jobs                        | ['-j', '--jobs']                        | <IntRange x>=1>                                                                                                                            | the parallelization factor                                                                                                                                                                                                                                                                   | 4                                   |
| nslots                      | ['-n', '--nslots']                      | <IntRange x>=1>                                                                                                                            | override the # of simulation runs in the config file                                                                                                                                                                                                                                         |                                     |
| in_run_id                   | ['--in-id']                             | STRING                                                                                                                                     | Unique identifier for the run                                                                                                                                                                                                                                                                |                                     |
| out_run_id                  | ['--out-id']                            | STRING                                                                                                                                     | Unique identifier for the run                                                                                                                                                                                                                                                                |                                     |
| in_prefix                   | ['--in-prefix']                         | STRING                                                                                                                                     | unique identifier for the run                                                                                                                                                                                                                                                                |                                     |
| first_sim_index             | ['-i', '--first_sim_index']             | <IntRange x>=1>                                                                                                                            | The index of the first simulation                                                                                                                                                                                                                                                            | 1                                   |
| stoch_traj_flag             | ['--stochastic']                        | BOOL                                                                                                                                       | Run stochastic simulations?                                                                                                                                                                                                                                                                  | False                               |
| write_csv                   | ['--write-csv']                         | BOOL                                                                                                                                       | write csv output?                                                                                                                                                                                                                                                                            | False                               |
| write_parquet               | ['--write-parquet']                     | BOOL                                                                                                                                       | write parquet output?                                                                                                                                                                                                                                                                        | True                                |
| flepi_path                  | ['--flepi-path']                        | <click.types.Path object at 0x12e3151f0>                                                                                                   | Path to the flepiMoP directory being used.                                                                                                                                                                                                                                                   |                                     |
| project_path                | ['--project-path']                      | <click.types.Path object at 0x12e64c470>                                                                                                   | Path to the project directory being used.                                                                                                                                                                                                                                                    |                                     |
| conda_env                   | ['--conda-env']                         | STRING                                                                                                                                     | The conda environment to use for the job.                                                                                                                                                                                                                                                    | flepimop-env                        |
| blocks                      | ['--blocks']                            | <IntRange x>=1>                                                                                                                            | The number of sequential blocks to run per a chain.                                                                                                                                                                                                                                          |                                     |
| chains                      | ['--chains']                            | <IntRange x>=1>                                                                                                                            | The number of chains or walkers, depending on inference method, to run.                                                                                                                                                                                                                      |                                     |
| samples                     | ['--samples']                           | <IntRange x>=1>                                                                                                                            | The number of samples per a block.                                                                                                                                                                                                                                                           |                                     |
| simulations                 | ['--simulations']                       | <IntRange x>=1>                                                                                                                            | The number of simulations per a block.                                                                                                                                                                                                                                                       |                                     |
| time_limit                  | ['--time-limit']                        | <gempyor._click.DurationParamType object at 0x12e5b4410>                                                                                   | The time limit for the job. If units are not specified, minutes are assumed.                                                                                                                                                                                                                 | 1hr                                 |
| batch_system                | ['--batch-system']                      | STRING                                                                                                                                     | The name of the batch system being used.                                                                                                                                                                                                                                                     |                                     |
| local                       | ['--local']                             | BOOL                                                                                                                                       | Flag to use the local batch system. Equivalent to `--batch-system local`.                                                                                                                                                                                                                    | False                               |
| slurm                       | ['--slurm']                             | BOOL                                                                                                                                       | Flag to use the slurm batch system. Equivalent to `--batch-system slurm`.                                                                                                                                                                                                                    | False                               |
| cluster                     | ['--cluster']                           | STRING                                                                                                                                     | The name of the cluster being used, only needed if cluster info is required.                                                                                                                                                                                                                 |                                     |
| nodes                       | ['--nodes']                             | <IntRange x>=1>                                                                                                                            | Override for the number of nodes to use.                                                                                                                                                                                                                                                     |                                     |
| cpus                        | ['--cpus']                              | <IntRange x>=1>                                                                                                                            | Override for the number of CPUs per node to use.                                                                                                                                                                                                                                             |                                     |
| memory                      | ['--memory']                            | <gempyor._click.MemoryParamType object at 0x12e5b4470>                                                                                     | Override for the amount of memory per node to use in MB.                                                                                                                                                                                                                                     |                                     |
| from_estimate               | ['--from-estimate']                     | <click.types.Path object at 0x12e5b4530>                                                                                                   | The path to a previous estimation file to use for the job. This will override the job resources and time limit given.                                                                                                                                                                        |                                     |
| estimate                    | ['--estimate']                          | BOOL                                                                                                                                       | Should this be submitted as an estimation job? If this flag is given then several jobs will be submitted with smaller sizes to estimate the time and resources needed for the full job. A time limit and memory requirement must still be given, but act as upper bounds on estimation jobs. | False                               |
| estimate_runs               | ['--estimate-runs']                     | <IntRange x>=6>                                                                                                                            | The number of estimation runs to perform. Must be at least 6 due to the estimation method, but more runs will provide a better estimate.                                                                                                                                                     | 10                                  |
| estimate_interval           | ['--estimate-interval']                 | <FloatRange 0.0<=x<=1.0>                                                                                                                   | The size of the prediction interval to use for estimating the required resources. Must be between 0 and 1.                                                                                                                                                                                   | 0.9                                 |
| estimate_vary               | ['--estimate-vary']                     | Choice(['blocks', 'chains', 'simulations'])                                                                                                | The job size fields to vary for estimating the resources needed for the job. This should be a subset of the job size fields.                                                                                                                                                                 | ['blocks', 'chains', 'simulations'] |
| estimate_factors            | ['--estimate-factors']                  | Choice(['samples', 'simulations_per_chain', 'total_samples', 'samples_per_chain', 'total_simulations', 'blocks', 'simulations', 'chains']) | The factors to use for estimating the resources needed for the job. This should be a subset of the job size fields. Also keep in mind to avoid using colinear factors, i.e. blocks and simulations per a block. Doing so can lead to unstable estimates.                                     | ['total_simulations']               |
| estimate_measurements       | ['--estimate-measurements']             | Choice(['cpu', 'memory', 'time'])                                                                                                          | The measurements to use for estimating the resources needed for the job.                                                                                                                                                                                                                     | ['memory', 'time']                  |
| estimate_scale_upper        | ['--estimate-scale-upper']              | FLOAT                                                                                                                                      | The upper scale to use for estimating the resources needed for the job. This is the factor to scale the job size by to get the upper bound for the estimation job sizes.                                                                                                                     | 3.0                                 |
| estimate_scale_lower        | ['--estimate-scale-lower']              | FLOAT                                                                                                                                      | The lower scale to use for estimating the resources needed for the job. This is the factor to scale the job size by to get the lower bound for the estimation job sizes.                                                                                                                     | 10.0                                |
| skip_manifest               | ['--skip-manifest']                     | BOOL                                                                                                                                       | Flag to skip writing a manifest file, useful in dry runs.                                                                                                                                                                                                                                    | False                               |
| skip_checkout               | ['--skip-checkout']                     | BOOL                                                                                                                                       | Flag to skip checking out a new branch in the git repository, useful in dry runs.                                                                                                                                                                                                            | False                               |
| debug                       | ['--debug']                             | BOOL                                                                                                                                       | Flag to enable debugging in batch submission scripts.                                                                                                                                                                                                                                        | False                               |
| extra                       | ['--extra']                             | STRING                                                                                                                                     | Extra options to pass to the batch system. Please consult the batch system documentation for valid options.                                                                                                                                                                                  |                                     |
| verbosity                   | ['-v', '--verbose']                     | <IntRange x>=0>                                                                                                                            | The verbosity level to use for this command.                                                                                                                                                                                                                                                 | 0                                   |
| dry_run                     | ['--dry-run']                           | BOOL                                                                                                                                       | Should this command be run using dry run?                                                                                                                                                                                                                                                    | False                               |

## sync:

### sync
| name            | option               | type                                     | description                                                                                           |   default |
|:----------------|:---------------------|:-----------------------------------------|:------------------------------------------------------------------------------------------------------|----------:|
| protocol        | ['-p', '--protocol'] | STRING                                   | sync protocol to use from CONFIG_FILES                                                                |           |
| source_override | ['-s', '--source']   | <click.types.Path object at 0x12e434d40> | source directory to 'push' changes from                                                               |           |
| target_override | ['-t', '--target']   | <click.types.Path object at 0x12e5b4dd0> | target directory to 'push' changes to                                                                 |           |
| filter_suffix   | ['-e', '--fsuffix']  | STRING                                   | Add a filter to the end of the filter list in CONFIG_FILES (same as `-f` if that list is empty)       |           |
| filter_prefix   | ['-a', '--fprefix']  | STRING                                   | Add a filter to the beginning of the filter list in CONFIG_FILES (same as `-f` if that list is empty) |           |
| filter_override | ['-f', '--filter']   | STRING                                   | replace the filter list in CONFIG_FILES; can be specified multiple times                              |           |
| nofilter        | ['--no-filter']      | BOOL                                     | ignore all filters in config file                                                                     |     False |
| reverse         | ['--reverse']        | BOOL                                     | reverse the source and target directories                                                             |     False |
| mkpath          | ['--mkpath']         | BOOL                                     | Before syncing, manually ensure destination directory exists.                                         |     False |
| dryrun          | ['-n', '--dry-run']  | BOOL                                     | perform a dry run of the sync operation                                                               |     False |
| verbosity       | ['-v', '--verbose']  | <IntRange x>=0>                          | The verbosity level to use for this command.                                                          |         0 |

## patch:

### patch
| name                        | option                                  | type                                     | description                                           | default   |
|:----------------------------|:----------------------------------------|:-----------------------------------------|:------------------------------------------------------|:----------|
| config_filepath             | ['-c', '--config']                      | <click.types.Path object at 0x12de96090> | Deprecated: configuration file(s) for this simulation |           |
| seir_modifiers_scenarios    | ['-s', '--seir_modifiers_scenarios']    | STRING                                   | override/select the transmission scenario(s) to run   | []        |
| outcome_modifiers_scenarios | ['-d', '--outcome_modifiers_scenarios'] | STRING                                   | override/select the outcome scenario(s) to run        | []        |
| jobs                        | ['-j', '--jobs']                        | <IntRange x>=1>                          | the parallelization factor                            | 4         |
| nslots                      | ['-n', '--nslots']                      | <IntRange x>=1>                          | override the # of simulation runs in the config file  |           |
| in_run_id                   | ['--in-id']                             | STRING                                   | Unique identifier for the run                         |           |
| out_run_id                  | ['--out-id']                            | STRING                                   | Unique identifier for the run                         |           |
| in_prefix                   | ['--in-prefix']                         | STRING                                   | unique identifier for the run                         |           |
| first_sim_index             | ['-i', '--first_sim_index']             | <IntRange x>=1>                          | The index of the first simulation                     | 1         |
| stoch_traj_flag             | ['--stochastic']                        | BOOL                                     | Run stochastic simulations?                           | False     |
| write_csv                   | ['--write-csv']                         | BOOL                                     | write csv output?                                     | False     |
| write_parquet               | ['--write-parquet']                     | BOOL                                     | write parquet output?                                 | True      |